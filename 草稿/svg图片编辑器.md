# SVG 绘图工具技术文档

## 一、概述

本工具是基于 Qt 框架开发的 SVG 绘图程序，旨在实现用户绘制 SVG 图形、修改已绘制图形等功能（依据要求，工具应支持图形的导出保存，但目前该功能尚未完成开发）。在开发过程中，采用模块化设计理念，将程序拆解为多个独立的小模块，这种设计不仅使编码思路更加清晰，也为后期的维护工作提供了便利。

## 二、系统架构

### 2.1 整体架构

程序采用经典的 MVC 架构模式，该模式在众多项目中得到广泛应用，具有良好的结构性和可维护性。通过将程序划分为以下三个部分，实现了功能的分离和协作：

- **模型层**：由 CSystemData 类承担管理所有图形数据的职责，确保数据的一致性和完整性，为整个程序的数据操作提供可靠的基础。

- **视图层**：CDrawWidget 类专注于图形的显示工作，将模型层中的图形数据以可视化的方式呈现给用户，使用户能够直观地看到自己绘制的图形。

- **控制层**：CDrawingBoardWidget 类负责处理用户的交互操作，例如点击、拖动等操作，并将这些操作转化为程序能够理解和处理的命令，实现用户与程序之间的交互。

### 2.2 核心类设计

程序中设计了几个关键的类，它们之间通过继承和协作，实现了对图形数据的管理、绘制和交互处理等功能，类结构如下：

```
- CSystemData           # 采用单例模式，负责管理所有图形数据，确保数据的唯一性
- CShapeData            # 作为图形数据的基类，定义了图形数据的公共接口，其他具体图形类均继承于此
  - CRectangleData      # 矩形数据类，封装矩形图形的相关属性和操作
  - CEllipseData        # 椭圆数据类，封装椭圆图形的相关属性和操作
  - CTriangleData       # 三角形数据类，封装三角形图形的相关属性和操作
  - CLineData           # 直线数据类，封装直线图形的相关属性和操作
  - CTextData           # 文本数据类，封装文本图形的相关属性和操作
  - CPentagonData       # 五边形数据类，封装五边形图形的相关属性和操作
  - CHexagonData        # 六边形数据类，封装六边形图形的相关属性和操作
  - CFreehandData       # 自由手绘数据类，封装自由手绘图形的相关属性和操作
- CDrawWidget           # 继承自QOpenGLWidget，作为绘图区域，负责将图形数据绘制到界面上
- CDrawingBoardWidget   # 作为主窗口部件，处理用户的各种操作，实现与用户的交互
```

## 三、技术亮点

### 3.1 内存管理

- **智能指针运用**：使用 QVector 存储图形数据的指针，借助 Qt 框架的内存管理机制，当程序关闭时，这些指针会被自动释放，有效避免了内存泄漏问题，提高了程序的稳定性。

- **数据结构选择**：选用向量容器来存储数据，主要得益于其具有快速的数据访问速度和灵活的动态扩展能力，能够满足程序在运行过程中对数据的高效操作和频繁更新的需求。

- **单例模式设计**：CSystemData 类采用单例模式，确保在程序的任何位置获取到的图形数据都是唯一的实例，避免了数据的不一致性，同时也节省了系统资源，提高了数据管理的效率。

### 3.2 性能优化

- **抗锯齿渲染技术**：在绘图过程中，启用 QPainter 的抗锯齿功能，对图形的边缘进行平滑处理，使绘制出来的图形边缘更加细腻、流畅，提升了用户的视觉体验。

### 3.3 类设计特点

- **继承与多态机制**：以 CShapeData 作为抽象基类，派生出各种具体的图形类。这种设计使得不同类型的图形虽然具有不同的实现细节，但对外提供了统一的接口，方便了代码的编写和维护，增强了程序的扩展性。

- **职责明确原则**：每个类都严格遵循单一职责原则，仅负责处理自身特定的功能。例如，CDrawWidget 类专注于图形的绘制工作，CSystemData 类专注于图形数据的管理，这种清晰的职责划分降低了类之间的耦合度，提高了程序的可维护性。

- **模块化设计思想**：各个功能模块之间保持相对松散的耦合关系，模块内部具有较高的内聚性。这种设计使得在后续的开发过程中，若需要添加新的功能，只需针对相应的模块进行扩展，而不会对其他模块造成较大的影响，提高了程序的可扩展性和灵活性。

## 四、待改进点

### 4.1 功能完整性

- **属性面板缺失**：当前程序尚未实现属性面板功能，用户无法对图形的颜色、大小、位置等属性进行修改和设置，后续需要设计并开发属性面板，以满足用户对图形属性编辑的需求。

- **图片编辑功能不足**：程序目前不支持图片的导入和编辑操作，在实际使用中存在一定的局限性。后续计划添加图片导入接口和编辑工具，使用户能够在绘图区域中对图片进行插入、缩放、旋转等操作。

- **文件管理不完善**：

- SVG 加载功能仅完成了基本的框架搭建，对于 SVG 文件的解析逻辑尚未实现，导致无法正确加载和显示 SVG 文件。接下来需要深入研究 SVG 文件格式，实现文件的解析和加载功能。

- 缺乏配置管理功能，无论是本地配置还是在线配置都未进行开发，用户无法对程序的参数和设置进行保存和加载，使用起来不够便捷。后续需要设计配置管理模块，支持用户对程序配置的自定义和管理。

### 4.2 性能优化

- **大规模渲染效率问题**：当绘制大量图形时，程序可能会出现运行卡顿的现象，主要原因是渲染效率不高。需要进一步分析渲染过程，优化渲染算法和数据结构，提高在大规模图形渲染时的性能。

- **内存占用问题**：随着程序运行时间的增长，内存占用可能会逐渐增加，可能存在潜在的内存泄漏或不合理的内存分配问题。需要使用内存分析工具对程序进行检测，找出内存占用异常的原因，并进行针对性的优化。

### 4.3 用户体验

- **撤销 / 重做功能缺失**：目前程序不支持撤销和重做操作，用户在绘制过程中如果出现错误，无法方便地进行修改，只能通过重新绘制来纠正错误，降低了用户的操作效率和体验。后续需要实现撤销 / 重做功能，记录用户的操作历史，方便用户进行错误纠正。

### 4.4 代码结构

- **注释不足**：部分代码在编写过程中没有添加必要的注释，导致代码的可读性较差，不仅给后期的维护工作带来困难，甚至在一段时间后自己也难以理解代码的逻辑。需要对代码进行全面的梳理，为关键的函数、类和逻辑段落添加清晰的注释，提高代码的可阅读性。

- **错误处理不完善**：程序中对一些特殊情况和异常输入的处理不够全面，可能会导致程序在运行过程中出现崩溃或错误提示不友好的情况。需要增强错误处理机制，对可能出现的异常情况进行捕获和处理，给出合理的错误提示信息，提高程序的健壮性。

- **资源管理混乱**：对于图标、样式表等资源的管理较为混乱，存在图标缺失、样式表引用不规范等问题，影响了程序界面的美观和一致性。需要对资源进行统一的管理和整理，确保资源的正确引用和合理使用。

## 五、总结

在开发本 SVG 绘图工具的过程中，在内存管理、性能优化和类设计等方面进行了积极的探索和实践，采用的 MVC 架构和模块化设计方法为程序奠定了良好的基础，保证了程序的稳定性和可维护性。然而，经过对程序的全面审视，发现仍存在功能不完善、性能有待提升、用户体验不够友好以及代码结构需要优化等问题。

针对这些问题，接下来的计划是首先优先实现缺失的功能，如属性面板、图片编辑、文件管理等，完善工具的基本功能；然后对程序进行性能优化，解决大规模渲染卡顿和内存占用问题；同时，注重用户体验的提升，添加撤销 / 重做功能，优化界面和交互设计；最后，对代码进行全面的整理和优化，补充注释，完善错误处理和资源管理，使整个程序更加健壮、易用。通过不断的改进和完善，努力将该绘图工具打造成一个功能强大、性能稳定、用户体验良好的实用工具。